LIBRARY_GL_STRING_RESOURCES_SRCS = $(patsubst %.resource_string, string_resources_cpp/%.resource_string.cpp, $(LIBRARY_GL_RESOURCE_STRING) )
CLEAN_FILES += $(LIBRARY_GL_STRING_RESOURCES_SRCS)

NGL_GL_SRCS = $(NGL_COMMON_SRCS) $(NGL_GL_CPP)
NGL_GLES_SRCS = $(NGL_COMMON_SRCS) $(NGL_GLES_CPP)

# $1 --> GL or GLES
# $2 --> debug or release
# $3 --> (0: skip build target 1: add build target)
define glrule
$(eval LIBRARY_$(1)_$(2)_OBJS = $$(patsubst %.cpp, $(2)/$(1)/%.o, $(LIBRARY_GL_SOURCES))
NGL_$(1)_$(2)_OBJ = $$(patsubst %.cpp, $(2)/$(1)/%.o, $$(NGL_$(1)_SRCS))
LIBRARY_$(1)_$(2)_DEPS = $$(patsubst %.cpp, $(2)/$(1)/%.d, $$(LIBRARY_GL_SOURCES))
LIBRARY_$(1)_$(2)_RESOURCE_OBJS = $$(patsubst %.cpp, $(2)/%.o, $$(LIBRARY_GL_STRING_RESOURCES_SRCS))
LIBRARY_$(1)_$(2)_ALL_OBJS = $$(LIBRARY_$(1)_$(2)_OBJS) $$(LIBRARY_$(1)_$(2)_RESOURCE_OBJS)
FASTUIDRAW_$(1)_$(2)_LIBS = -lFastUIDraw$(1)_$(2) -lN$(1)_$(2) -lFastUIDraw_$(2) $(LIBRARY_LIBS)
CLEAN_FILES += $$(LIBRARY_$(1)_$(2)_ALL_OBJS) $$(LIBRARY_$(1)_$(2)_ALL_OBJS)
SUPER_CLEAN_FILES += $$(LIBRARY_$(1)_$(2)_DEPS) $$(LIBRARY_$(1)_$(2)_DEPS) $$(NGL_$(1)_$(2)_OBJ)
CLEAN_FILES += libFastUIDraw$(1)_$(2).dll libFastUIDraw$(1)_$(2).dll.a libN$(1)_$(2).dll libN$(1)_$(2).dll.a
CLEAN_FILES += libFastUIDraw$(1)_$(2).so libN$(1)_$(2).so
ifeq ($(3),1)
ifneq ($$(MAKECMDGOALS),clean)
ifneq ($$(MAKECMDGOALS),targets)
ifneq ($$(MAKECMDGOALS),clean-all)
ifneq ($$(MAKECMDGOALS),docs)
-include $$(LIBRARY_$(1)_$(2)_DEPS)
endif
endif
endif
endif
ifeq ($(MINGW_BUILD),1)
libFastUIDraw$(1)_$(2): libFastUIDraw$(1)_$(2).dll
libFastUIDraw$(1)_$(2).dll: libFastUIDraw_$(2).dll libN$(1)_$(2).dll $$(LIBRARY_$(1)_$(2)_ALL_OBJS)
	$(CXX) -shared -Wl,--out-implib,libFastUIDraw$(1)_$(2).dll.a -o libFastUIDraw$(1)_$(2).dll $$(LIBRARY_$(1)_$(2)_ALL_OBJS) $$(LIBRARY_GL_LIBS) -L. -lFastUIDraw_$(2) -lN$(1)_$(2) $$(LIBRARY_LIBS)
libN$(1)_$(2).dll: $$(NGL_$(1)_$(2)_OBJ)
	$(CXX) -shared -Wl,--out-implib,libN$(1)_$(2).dll.a -o libN$(1)_$(2).dll $$(NGL_$(1)_$(2)_OBJ)
INSTALL_LIBS += libFastUIDraw$(1)_$(2).dll libFastUIDraw$(1)_$(2).dll.a libN$(1)_$(2).dll libN$(1)_$(2).dll.a
else
libFastUIDraw$(1)_$(2): libFastUIDraw$(1)_$(2).so
libFastUIDraw$(1)_$(2).so: libFastUIDraw_$(2).so libN$(1)_$(2).so $$(LIBRARY_$(1)_$(2)_ALL_OBJS)
	$(CXX) -shared -Wl,-soname,libFastUIDraw$(1)_$(2).so -o libFastUIDraw$(1)_$(2).so $$(LIBRARY_$(1)_$(2)_ALL_OBJS) $$(LIBRARY_GL_LIBS) -L. -lFastUIDraw_$(2) -lN$(1)_$(2) $$(LIBRARY_LIBS)
libN$(1)_$(2).so: $$(NGL_$(1)_$(2)_OBJ)
	$(CXX) -shared -Wl,-soname,libN$(1)_$(2).so -o libN$(1)_$(2).so $$(NGL_$(1)_$(2)_OBJ)
LIBFASTUIDRAW_$(1)_$(2) = libFastUIDraw$(1)_$(2).so
LIBN$(1)_$(2) = libN$(1)_$(2).so
INSTALL_LIBS += libFastUIDraw$(1)_$(2).so libN$(1)_$(2).so
endif
endif
)
endef

# $1 --> GL or GLES
# $2 --> (0: skip build target 1: add build target)
define glrules
$(eval $(call glrule,$(1),release,$(2))
$(call glrule,$(1),debug,$(2))
ifeq ($(2),1)
TARGETLIST += libFastUIDraw$(1) libFastUIDraw$(1)_debug libFastUIDraw$(1)_release
libFastUIDraw$(1): libFastUIDraw$(1)_debug libFastUIDraw$(1)_release
.PHONY: libFastUIDraw$(1)
.PHONY: libFastUIDraw$(1)_release
.PHONY: libFastUIDraw$(1)_debug
endif
)
endef

$(call glrules,GL,$(BUILD_GL))
$(call glrules,GLES,$(BUILD_GLES))
