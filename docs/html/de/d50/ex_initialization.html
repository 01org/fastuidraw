<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FastUIDraw: Example Initialization</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FastUIDraw
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example Initialization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Example code that shows how to create a Painter and to use the GL backend</p>
<p>The Example Initialization builds from <a class="el" href="../../d4/da1/ex_framework.html">Example FrameWork</a> to demonstrate how to initialize FastUIDraw's GL (or GLES) backend and to create a <a class="el" href="../../da/de0/classfastuidraw_1_1_painter.html" title="Painter implements a canvas rendering interface. ">fastuidraw::Painter</a> object.</p>
<p>The interface is defined by: </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/d77/painter_8hpp.html">fastuidraw/painter/painter.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d61/painter__engine__gl_8hpp.html">fastuidraw/gl_backend/painter_engine_gl.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/d5a/painter__surface__gl_8hpp.html">fastuidraw/gl_backend/painter_surface_gl.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;example_framework.hpp&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>initialization:<span class="keyword">public</span> example_framework</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  initialization(<span class="keywordtype">void</span>);</div><div class="line">  ~initialization();</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">  <span class="keyword">virtual</span></div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  draw_frame(<span class="keywordtype">void</span>) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">  <span class="keyword">virtual</span></div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  derived_init(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">  <span class="keyword">virtual</span></div><div class="line">  <span class="keywordtype">void</span></div><div class="line">  handle_event(<span class="keyword">const</span> SDL_Event &amp;ev) <span class="keyword">override</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="comment">/* A PainterEngine represents how a Painter will issue commands to</span></div><div class="line"><span class="comment">   * a 3D API</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../de/d73/classfastuidraw_1_1reference__counted__ptr.html">fastuidraw::reference_counted_ptr&lt;fastuidraw::gl::PainterEngineGL&gt;</a> m_painter_engine_gl;</div><div class="line"></div><div class="line">  <span class="comment">/* A Painter is the interface with which to render 2D content with FastUIDraw</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../de/d73/classfastuidraw_1_1reference__counted__ptr.html">fastuidraw::reference_counted_ptr&lt;fastuidraw::Painter&gt;</a> m_painter;</div><div class="line"></div><div class="line">  <span class="comment">/* A PainterSurface is to where to render content via a Painter.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../de/d73/classfastuidraw_1_1reference__counted__ptr.html">fastuidraw::reference_counted_ptr&lt;fastuidraw::gl::PainterSurfaceGL&gt;</a> m_surface_gl;</div><div class="line">};</div><div class="line"></div></div><!-- fragment --><p> The implementation is given by: </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d6d/gl__binding_8hpp.html">fastuidraw/gl_backend/gl_binding.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/da7/ngl__header_8hpp.html">fastuidraw/gl_backend/ngl_header.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;initialization.hpp&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span></div><div class="line"><span class="keywordtype">void</span>*</div><div class="line"><a class="code" href="../../d8/d4c/namespacefastuidraw_1_1gl__binding.html#ac3e092e804d70c2aefd4abe3db937bfa">get_proc</a>(<a class="code" href="../../d4/d4c/namespacefastuidraw.html#af4f69794f023ec29dddc1b586305e35a">fastuidraw::c_string</a> proc_name)</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> SDL_GL_GetProcAddress(proc_name);</div><div class="line">}</div><div class="line"></div><div class="line">initialization::</div><div class="line">initialization(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">/* The ctor is empty because we need a GL context current before</span></div><div class="line"><span class="comment">   * we can create the fastuidraw::PainterEngine which is needed to</span></div><div class="line"><span class="comment">   * create the fastuidraw::Painter. Recall that the example_framework</span></div><div class="line"><span class="comment">   * class has not yet created the GL context (or window even) until</span></div><div class="line"><span class="comment">   * later</span></div><div class="line"><span class="comment">   */</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">initialization::</div><div class="line">derived_init(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <span class="comment">/* Recall that example_framework has created the window</span></div><div class="line"><span class="comment">   * GL context and made the GL conrext current by the time</span></div><div class="line"><span class="comment">   * it calls derived_init(). Now is the time we can perform</span></div><div class="line"><span class="comment">   * initialization for FastUIDraw</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../da/d46/group___utility.html#gaedbd7e08eca6b5f0d2964ea963ee4e57">FASTUIDRAWunused</a>(argc);</div><div class="line">  <a class="code" href="../../da/d46/group___utility.html#gaedbd7e08eca6b5f0d2964ea963ee4e57">FASTUIDRAWunused</a>(argv);</div><div class="line"></div><div class="line">  <span class="comment">/* The GL (or GLES) backend need a way to fetch the GL (or GLES)</span></div><div class="line"><span class="comment">   * function pointers. It is the applications responsibility to</span></div><div class="line"><span class="comment">   * provide to FastUIDraw a function to fetch the GL (or GLES)</span></div><div class="line"><span class="comment">   * function pointers. We wrap the SDL function SDL_GL_GetProcAddress()</span></div><div class="line"><span class="comment">   * in get_proc() static function to make sure that the function</span></div><div class="line"><span class="comment">   * signatures match precisely. DANGER: on MS-Windows, the function</span></div><div class="line"><span class="comment">   * to fetch GL function pointers requires that the GL context</span></div><div class="line"><span class="comment">   * with which they are used is current (this is not the case on</span></div><div class="line"><span class="comment">   * Unix). An additional danger with MS-Windows is that the function</span></div><div class="line"><span class="comment">   * pointers fetched may or may not be compatible with a different</span></div><div class="line"><span class="comment">   * GL context.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../d8/d4c/namespacefastuidraw_1_1gl__binding.html#a373237281dcbe1589e914dfc4bd4ad81">fastuidraw::gl_binding::get_proc_function</a>(<a class="code" href="../../d8/d4c/namespacefastuidraw_1_1gl__binding.html#ac3e092e804d70c2aefd4abe3db937bfa">get_proc</a>);</div><div class="line"></div><div class="line">  <span class="comment">/* Now that FastUIDraw can fetch the GL (or GLES) function pointers</span></div><div class="line"><span class="comment">   * we can now create our FastUIDraw objects.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * The first object to create is the fastuidraw::gl::PaintEngineGL</span></div><div class="line"><span class="comment">   * which embodies how FastUIDraw uses the GL (or GLES) to draw. A</span></div><div class="line"><span class="comment">   * fastuidraw::gl::PaintEngineGL&#39;s configuration is controlled by</span></div><div class="line"><span class="comment">   * a fastuidraw::gl::PaintEngineGL::ConfigurationGL value. For this</span></div><div class="line"><span class="comment">   * example, we let FastUIDraw query the GL context properties and</span></div><div class="line"><span class="comment">   * from that decide all the values within the configuration.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../dd/d69/classfastuidraw_1_1gl_1_1_painter_engine_g_l_1_1_configuration_g_l.html">fastuidraw::gl::PainterEngineGL::ConfigurationGL</a> engine_params;</div><div class="line">  engine_params.<a class="code" href="../../dd/d69/classfastuidraw_1_1gl_1_1_painter_engine_g_l_1_1_configuration_g_l.html#acab4ca88f1529868472e5d34b6023290">configure_from_context</a>();</div><div class="line"></div><div class="line">  <span class="comment">/* FastUIDraw makes heavy use of reference counting to make memory</span></div><div class="line"><span class="comment">   * managment easier. In addition, FastUIDraw provides the macros</span></div><div class="line"><span class="comment">   * FASTUIDRAWnew and FASTUIDRAWdelete which under debug builds</span></div><div class="line"><span class="comment">   * record object creation and deletion so that if an object is</span></div><div class="line"><span class="comment">   * created and not deleted an error message is printed and to</span></div><div class="line"><span class="comment">   * also print an error message if an object is deleted with</span></div><div class="line"><span class="comment">   * FASTUIDRAWdelete that was not created with FASTUIDRAWnew. The</span></div><div class="line"><span class="comment">   * main consequence of the system is that the creation of any</span></div><div class="line"><span class="comment">   * FastUIDraw objects must be done with FASTUIDRAWnew.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_painter_engine_gl = <a class="code" href="../../d5/ddf/classfastuidraw_1_1gl_1_1_painter_engine_g_l.html#ad32c586532f7c84339ffd76b5ba25628">fastuidraw::gl::PainterEngineGL::create</a>(engine_params);</div><div class="line"></div><div class="line">  <span class="comment">/* Now that we have the fastuidraw::PainterEngine derived class,</span></div><div class="line"><span class="comment">   * we can create our fastuidraw::Painter object. A fastuidraw::Painter</span></div><div class="line"><span class="comment">   * object is a HEAVY object (because it implements various pools)</span></div><div class="line"><span class="comment">   * and such objects should not be created within ones render/event</span></div><div class="line"><span class="comment">   * loops. However, it is perfectly fine (and the correct thing to do)</span></div><div class="line"><span class="comment">   * to create multiple fastuidraw::Painter objects using the same</span></div><div class="line"><span class="comment">   * fastuidraw::PainterEngine object</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_painter = <a class="code" href="../../da/d46/group___utility.html#ga524a8b6674554f360cf8b04a3a6a37b0">FASTUIDRAWnew</a> <a class="code" href="../../da/de0/classfastuidraw_1_1_painter.html">fastuidraw::Painter</a>(m_painter_engine_gl);</div><div class="line"></div><div class="line">  <span class="comment">/* Create the surface to which the Painter will render content.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_surface_gl = <a class="code" href="../../da/d46/group___utility.html#ga524a8b6674554f360cf8b04a3a6a37b0">FASTUIDRAWnew</a> <a class="code" href="../../df/d29/classfastuidraw_1_1gl_1_1_painter_surface_g_l.html">fastuidraw::gl::PainterSurfaceGL</a>(window_dimensions(), *m_painter_engine_gl);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">initialization::</div><div class="line">handle_event(<span class="keyword">const</span> SDL_Event &amp;ev)</div><div class="line">{</div><div class="line">  <span class="keywordflow">switch</span> (ev.type)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">case</span> SDL_WINDOWEVENT:</div><div class="line">      <span class="keywordflow">if</span> (ev.window.event == SDL_WINDOWEVENT_RESIZED)</div><div class="line">        {</div><div class="line">          <span class="comment">/* The window is resized so we need to adjust our surface</span></div><div class="line"><span class="comment">           * to the new size of the window. The reference_counted_ptr</span></div><div class="line"><span class="comment">           * interface will automacially delete the underlying</span></div><div class="line"><span class="comment">           * PainterSurfaceGL that we had made earlier for us</span></div><div class="line"><span class="comment">           */</span></div><div class="line">          <a class="code" href="../../d1/d96/classfastuidraw_1_1vec_n.html">fastuidraw::ivec2</a> new_dims(ev.window.data1,ev.window.data2);</div><div class="line">          m_surface_gl = <a class="code" href="../../da/d46/group___utility.html#ga524a8b6674554f360cf8b04a3a6a37b0">FASTUIDRAWnew</a> <a class="code" href="../../df/d29/classfastuidraw_1_1gl_1_1_painter_surface_g_l.html">fastuidraw::gl::PainterSurfaceGL</a>(new_dims, *m_painter_engine_gl);</div><div class="line">        }</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">      example_framework::handle_event(ev);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span></div><div class="line">initialization::</div><div class="line">draw_frame(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">/* We first need to set the viewport for surface when we start to draw */</span></div><div class="line">  <a class="code" href="../../d1/d96/classfastuidraw_1_1vec_n.html">fastuidraw::vec2</a> window_dims(window_dimensions());</div><div class="line">  <a class="code" href="../../d2/d7d/classfastuidraw_1_1_painter_surface_1_1_viewport.html">fastuidraw::PainterSurface::Viewport</a> vwp(0, 0, window_dims.x(), window_dims.y());</div><div class="line"></div><div class="line">  m_surface_gl-&gt;viewport(vwp);</div><div class="line"></div><div class="line">  <span class="comment">/* fastuidraw::Painter builds commands to send to the underlying 3D API.</span></div><div class="line"><span class="comment">   * Drawing commands to Painter may only be executed within a begin()/end()</span></div><div class="line"><span class="comment">   * pair. In addition, the effects on the surface to which the Painter</span></div><div class="line"><span class="comment">   * is drawing does not take effect until end() is called.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_painter-&gt;begin(m_surface_gl, <a class="code" href="../../d6/db7/classfastuidraw_1_1_painter_enums.html#a3e96faa847c849ddd2caea92b8a877e5a6e7fc1351dcd45f3d81025656670414c">fastuidraw::Painter::y_increases_downwards</a>);</div><div class="line"></div><div class="line">  <span class="comment">/* Later examples we will get into the various drawing commands of</span></div><div class="line"><span class="comment">   * fastuidraw::Painter, for now we just draw a white rect.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <a class="code" href="../../d9/d57/classfastuidraw_1_1_painter_brush.html">fastuidraw::PainterBrush</a> brush;</div><div class="line"></div><div class="line">  brush.<a class="code" href="../../d9/d57/classfastuidraw_1_1_painter_brush.html#ada4e8279af2a33eb3dde26fa43d43614">color</a>(1.0f, 1.0f, 1.0f, 1.0f);</div><div class="line">  m_painter-&gt;fill_rect(&amp;brush,</div><div class="line">                       <a class="code" href="../../d3/d44/classfastuidraw_1_1_rect_t.html">fastuidraw::Rect</a>()</div><div class="line">                       .min_point(window_dims * 0.25f)</div><div class="line">                       .max_point(window_dims * 0.75f));</div><div class="line"></div><div class="line">  <span class="comment">/* Issue fastuidraw::Painter::end() to send the accumulate draw commands</span></div><div class="line"><span class="comment">   * to the underlying 3D API to draw the content.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_painter-&gt;end();</div><div class="line"></div><div class="line">  <span class="comment">/* FastUIDraw&#39;s GL (and GLES) backend provide automatic GL (GLES)</span></div><div class="line"><span class="comment">   * function pointer fetching. In addition, with the FastUIDraw debug</span></div><div class="line"><span class="comment">   * build, call the GL (or GLES) functions through FastUIDraw adds</span></div><div class="line"><span class="comment">   * GL error checking that will print to stderr any GL errors encounted</span></div><div class="line"><span class="comment">   * together with the file and line number of the GL function that</span></div><div class="line"><span class="comment">   * triggered the error. To call the GL function glFoo through this</span></div><div class="line"><span class="comment">   * interface, one uses the macro-function fastuidraw_glFoo. The release</span></div><div class="line"><span class="comment">   * builds do NOT do the error checking making the cost of going through</span></div><div class="line"><span class="comment">   * the fastuidraw_glFoo macros to have no overhead.</span></div><div class="line"><span class="comment">   */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Make sure we are rendering to the default fraembuffer of GL */</span></div><div class="line">  fastuidraw_glBindFramebuffer(GL_DRAW_FRAMEBUFFER, 0);</div><div class="line"></div><div class="line">  <span class="comment">/* Clear the framebuffer */</span></div><div class="line">  fastuidraw_glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);</div><div class="line"></div><div class="line">  <span class="comment">/* blit the contents of m_surface to the default framebuffer</span></div><div class="line"><span class="comment">   * with nearest filtering</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  m_surface_gl-&gt;blit_surface(GL_NEAREST);</div><div class="line">}</div><div class="line"></div><div class="line">initialization::</div><div class="line">~initialization()</div><div class="line">{</div><div class="line">  <span class="comment">/* Recall that example_framework does not destroy the window</span></div><div class="line"><span class="comment">   * or GL context untils its dtor. Hence, the GL context is</span></div><div class="line"><span class="comment">   * current at our dtor. When the reference counted pointers</span></div><div class="line"><span class="comment">   * have their dtors&#39; called, they will decrement the reference</span></div><div class="line"><span class="comment">   * count which when it reaches zero will delete the object.</span></div><div class="line"><span class="comment">   * Of critical importance is that the last reference to the</span></div><div class="line"><span class="comment">   * fastuidraw::gl::PainterEngineGL goes away with a GL context</span></div><div class="line"><span class="comment">   * current so that the dtor of fastuidraw::gl::PainterEngineGL</span></div><div class="line"><span class="comment">   * will be able to call GL (or GLES) functions to free GL</span></div><div class="line"><span class="comment">   * resources. Since the dtor&#39;s of the reference counters</span></div><div class="line"><span class="comment">   * are called by C++ once this function exists, we have nothing</span></div><div class="line"><span class="comment">   * to do actually for FastUIDraw cleanup.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">}</div><div class="line"></div></div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
